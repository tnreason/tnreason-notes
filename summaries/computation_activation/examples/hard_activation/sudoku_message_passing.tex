\begin{example}[Constraint Propoagation for a $2^2\,x\,2^2$ Sudoku]
    \label{exa:sudokuMessagePassing}
    We iteratively solve a Sudoku puzzle (see \exaref{exa:sudokuEntailment}) by determining a possible value based on neighboring cells, rows and squares (using \theref{the:monotonicityPL}) and adding to our knowledge (using \theref{the:addingEntailed}).
    For example, consider the following $r=2$ Sudoku puzzle, where a first entailment step uses only the knowledge of the rules and the \textcolor{\concolor}{blue} cells to determine the value $3$ in the first square:
%    \begin{center}
%        \begin{tikzpicture}
%            \node[anchor=center, draw,inner sep=0pt] (1) at (0,0) {
%                \begin{tabular}{|c|c||c|c|}
%                    \hline
%                    1 &                          & \textcolor{\concolor}{3} & 2 \\ \hline
%                    & \textcolor{\concolor}{2} &                          &   \\ \hline\hline
%                    &                          & 4                        &   \\ \hline
%                    4 & 3                        &                          &   \\ \hline
%                \end{tabular}
%            };
%
%            \node[anchor=center] (ist) at (1.75,0) {$=$};
%
%            \node[anchor=center, draw,inner sep=0pt] (2) at (3.5,0) {
%                \begin{tabular}{|c|c||c|c|}
%                    \hline
%                    1                        &   & 3 & 2 \\ \hline
%                    \textcolor{\concolor}{3} & 2 &   &   \\ \hline\hline
%                    &   & 4 &   \\ \hline
%                    4                        & 3 &   &   \\ \hline
%                \end{tabular}
%            };
%
%            \node[anchor=center] (ist) at (6.25,0) {$= \quad \ldots \quad =$};
%
%            \node[anchor=center, draw,inner sep=0pt] (2) at (9,0) {
%                \begin{tabular}{|c|c||c|c|}
%                    \hline
%                    1 & 4 & 3 & 2 \\ \hline
%                    3 & 2 & 1 & 4 \\ \hline\hline
%                    2 & 1 & 4 & 3 \\ \hline
%                    4 & 3 & 2 & 1 \\ \hline
%                \end{tabular}
%            };
%
%        \end{tikzpicture}
%    \end{center}
    \begin{center}
        \begin{sudoku4x4}
            \matrix[sudokumatrix] (M) at (0,0) {
                1 & \ & \textcolor{\concolor}{3} & 2 \\
                \ & \textcolor{\concolor}{2} & \  & \  \\
                \ & \ & 4 & \ \\
                4 & 3 &  \ & \  \\
            };
            \draw[thick]([yshift=9.5pt,xshift=-0.6pt]M-1-2.east) -- ([yshift=-9.5pt,xshift=-0.6pt]M-4-2.east);
            \draw[thick]([xshift=-9.5pt,yshift=0.6pt]M-2-1.south) -- ([xshift=9.5pt,yshift=0.6pt]M-2-4.south);

            \node[anchor=center] (ist) at (1.75,0) {$=$};

            \matrix[sudokumatrix] (M) at (3.5,0) {
                1 & \ & 3 & 2 \\
                \textcolor{\probcolor}{3} & 2 & \  & \  \\
                \ & \ & 4 & \ \\
                4 & 3 &  \ & \  \\
            };
            \draw[thick]([yshift=9.5pt,xshift=-0.6pt]M-1-2.east) -- ([yshift=-9.5pt,xshift=-0.6pt]M-4-2.east);
            \draw[thick]([xshift=-9.5pt,yshift=0.6pt]M-2-1.south) -- ([xshift=9.5pt,yshift=0.6pt]M-2-4.south);

            \node[anchor=center] (ist) at (6.25,0) {$= \quad \ldots \quad =$};

            \matrix[sudokumatrix] (M) at (9,0) {
                1 & \textcolor{\probcolor}{4} & 3 & 2 \\
                \textcolor{\probcolor}{3} & 2 & \textcolor{\probcolor}{1} & \textcolor{\probcolor}{4}  \\
                \textcolor{\probcolor}{2} & \textcolor{\probcolor}{1} & 4 & \textcolor{\probcolor}{3} \\
                4 & 3 & \textcolor{\probcolor}{2} & \textcolor{\probcolor}{1}  \\
            };
            \draw[thick]([yshift=9.5pt,xshift=-0.6pt]M-1-2.east) -- ([yshift=-9.5pt,xshift=-0.6pt]M-4-2.east);
            \draw[thick]([xshift=-9.5pt,yshift=0.6pt]M-2-1.south) -- ([xshift=9.5pt,yshift=0.6pt]M-2-4.south);
        \end{sudoku4x4}
    \end{center}

    To illustrate the first reasoning step we make the following preliminary entailment steps applying \theref{the:monotonicityPL}:
    \begin{itemize}
        \item From $\textcolor{\concolor}{\catvariableof{0,1,0,1,1}}$ (i.e. the $2$ in the cell $(0,1,0,1)$) and the Sudoku rule that at the cell $(0,1,0,1)$ exactly one number is assigned, we get
        \begin{align*}
            \left( \woneoplus_{i\in[n^2]} \catvariableof{0,1,0,1,i} \right) \land \textcolor{\concolor}{\catvariableof{0,1,0,1,1}} \models \lnot\catvariableof{0,1,0,1,2} \, ,
        \end{align*}
        That is, that the number $3$ is not in the cell $(0,1,0,1)$.
        \item From $\textcolor{\concolor}{\catvariableof{0,0,1,0,2}}$ (i.e. the $3$ in the cell $(0,0,1,0)$) and the Sudoku rule that at the row $(0,0)$ exactly one number is assigned, we get
        \begin{align*}
            \left( \woneoplus_{c0,c1\in[n]} \catvariableof{0,0,c0,c1,2} \right) \land \textcolor{\concolor}{\catvariableof{0,0,1,0,2}} \models \lnot\catvariableof{0,0,0,0,2}\land \lnot\catvariableof{0,0,0,1,2} \, ,
        \end{align*}
        That is, that the number $3$ is neither in the cell $(0,0,0,0)$ not in $(0,0,0,1)$.
    \end{itemize}
    We add these formulas to our knowledge base (justified by \theref{the:addingEntailed}) and use the rule, that $3$ appears exactly once in the first square
    \begin{align*}
        &\left( \woneoplus_{r1,c1\in[n]} \catvariableof{0,r1,0,c1,2} \right)
        \land (\lnot\catvariableof{0,1,0,1,2})
        \land (\lnot\catvariableof{0,0,0,0,2}\land \lnot\catvariableof{0,0,0,1,2})
        \models \textcolor{\probcolor}{\catvariableof{0,1,0,0,2}} \, .
    \end{align*}
    That is, we conclude that the number $3$ must be in the cell $(0,1,0,0)$, which information is also included in the updated knowledge base for further reasoning steps.

    We now iteratively apply similar reasoning steps and store the entailed variables in \textcolor{\probcolor}{$E^{\mathrm{entailed}}$}, until we arrive at the right side of the above sketch.
    \begin{align*}
        \kb \land \left(\bigwedge_{(r_0,r_1,c_0,c_1,i)\in E^{\mathrm{start}}} \catvariableof{r0,r1,c0,c1,i} \right)
        \models \textcolor{\probcolor}{\left(\bigwedge_{(r_0,r_1,c_0,c_1,i)\in E^{\mathrm{entailed}}} \catvariableof{r0,r1,c0,c1,i} \right)} \, .
    \end{align*}
    Since all Sudoku rules are satisfied in the final assignment and to each cell $(r_0,r_1,c_0,c_1)$ we found exactly one $i\in[n^2]$ such that $(r_0,r_1,c_0,c_1,i)\in E^{\mathrm{start}}\cup\textcolor{\probcolor}{E^{\mathrm{entailed}}}$, there is a unique solution of the puzzle and we conclude
    \begin{align*}
        &\kb \land \left(\bigwedge_{(r_0,r_1,c_0,c_1,i)\in E^{\mathrm{start}}} \catvariableof{r0,r1,c0,c1,i} \right) \\
        &\quad= \left(\bigwedge_{(r_0,r_1,c_0,c_1,i)\in E^{\mathrm{start}}} \catvariableof{r0,r1,c0,c1,i} \right)
        \land \textcolor{\probcolor}{\left(\bigwedge_{(r_0,r_1,c_0,c_1,i)\in E^{\mathrm{entailed}}} \catvariableof{r0,r1,c0,c1,i} \right)} \, .
    \end{align*}

\end{example}