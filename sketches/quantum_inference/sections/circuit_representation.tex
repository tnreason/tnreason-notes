\section{Quantum Computation Basics}

\subsection{State Encoding Schemes}

Basis Encoding in Quantum Computation refers to the representation of classical $n$ bit strings by $n$ qubit basis states, and is called one-hot encoding in \tnreason{}.
The Basis Encoding scheme in \tnreason{} goes beyond this scheme and also encodes subsets by sums of one-hot encodings to the members of the set.
In this way, relations and functions are represented by boolean tensors and contraction of them is refered as \BasisCalculus{}.

Amplitude Encoding in Quantum Computation refers to the storage of complex numbers in the amplitudes of quantum states.
The pendant in \tnreason{} is the Coordinate Encoding scheme, where real numbers are stored in the coordinates of real-valued tensors.
Compared to Amplitude Encoding, Coordinate Encoding does not have the normalization constraint of quantum states.
The Amplitude Encoding of the square root of a probability distribution is sometimes called q-sample.

\subsection{Controlled Single Qubit Gates}

We define the rotation gate around the Y-axis by an angle $\alpha$ as
\begin{align*}
    \yrotationofat{\alpha}{\avariableof{\insymbol},\avariableof{\outsymbol}} \coloneqq
    \begin{bmatrix}
        \cosof{\frac{\alpha}{2}} & -\sinof{\frac{\alpha}{2}} \\
        \sinof{\frac{\alpha}{2}} & \cosof{\frac{\alpha}{2}}
    \end{bmatrix}
\end{align*}

Further we define the Pauli-X:
\begin{align*}
    \paulixat{\avariableof{\insymbol},\avariableof{\outsymbol}} \coloneqq
    \begin{bmatrix}
        0 & 1 \\
        1 & 0
    \end{bmatrix}
\end{align*}

%% Control notation
Controlled single qubit gates are defined using control qubits, where the gate is applied to the target qubit if the control qubits are in a specific state and the identity is applied otherwise.
In the tensor network diagrams, we do not distinguish between incoming and outgoing control qubit variables, since the control acts as a Dirac tensor.
Thus, controlled unitary with target qubit $\catvariableof{t}$ and control qubits $\catvariableof{c}$ are represented by tensors
\begin{align*}
    \contunitaryat{\catvariableof{t,\insymbol},\catvariableof{t,\outsymbol},\catvariableof{c}}
\end{align*}
where for each state $\catindexof{c}$ to the control variables we have that
\begin{align*}
    \contunitaryat{\catvariableof{t,\insymbol},\catvariableof{t,\outsymbol},\indexedcatvariableof{c}}
\end{align*}
is a unitary matrix acting on the leg space of the target variable.

\subsection{Measurements and Contractions}

\subsubsection{Direct measurement}

The computational basis measurement of the qubits $\catvariableof{\variableset}$ of a Quantum State $\qstatewith$ is equal to drawing samples from a distribution
\begin{align*}
    \probat{\catvariableof{\variableset}} = \contractionof{
        \qstatewith, \comconqstatewith
    }{\catvariableof{\variableset}} \, .
\end{align*}
Here $\comconqstatewith$ is the complex conjugate of $\qstatewith$.
When $\qstate$ is prepared by a quantum circuit acting on a initial state, the complex conjugate is the hermitean conjugate of the circuit acting on the complex conjgate of the initial state.

%% Add drawing!
We abbreviate these contractions by extending the contraction diagrams with measurement symbols (see \figref{fig:measurementSketch}).
\begin{figure}
    \begin{center}
        \input{tikz_pics/directed_measurement_sketch.tikz}
    \end{center}
    \caption{Computational Basis Measurement of a quantum state $\qstate$.
    The measurement symbols on the left side indicate the measured qubits and the first equation is understood as a definition.
    In the second equation we sketch, that the measurement distribution is equal to the contraction of the square absolute transform of $\qstate$ to the measured variables.
    }\label{fig:measurementSketch}
\end{figure}

%% Phase-Absolut decomposition
Each complex-valued tensor $\qstatewith$ has a decomposition into a phase tensor $\phasecorewith$ and an absolute tensor $\absof{\qstate}[\shortcatvariables]$ defined by
\begin{align*}
    \qstatewith = \contractionof{\expof{i\cdot\phasecorewith}, \absof{\qstatewith}}{\shortcatvariables}\, .
\end{align*}

The measurement distribution is depends only on $\absof{\phi}$, that is
\begin{align*}
    \probwith = \absof{\qstatewith}^2 \, .
\end{align*}
Note, that this measurement distribution is not sensitive to the phases of the amplitudes.

When only a subset of variables is measured, the distribution is the contraction of the absolute square transform (these operations do not commute)
\begin{align*}
    \probat{\catvariableof{\secnodes}}
    = \contractionof{\absof{\qstatewith}^2}{\catvariableof{\secnodes}} \, .
\end{align*}

%% Phasecore vanishing as gauging
When we are interested in the preparation of quantum states with a specific computational basis measurement distribution, we can restrict to states with vanishing phase cores, that is
\begin{align*}
    \qstatewith
    = \contractionof{\expof{i\cdot\zerosat{\shortcatvariables}}, \absof{\qstate}[\shortcatvariables]}{\shortcatvariables}
    = \absof{\qstate}[\shortcatvariables]  \, .
\end{align*}

\subsubsection{Phase sensitive measurement}

When applying a Walsh-Hadamard transform on the qubits $\nodes\backslash\secnodes$ to be closed (see \figref{fig:phaseContractionMeasurement}), the probability of measuring the closed qubits in the ground state is %we perform the contraction
\begin{align*}
    \probat{\catvariableof{\nodes\backslash\secnodes}=0_{\nodes\backslash\secnodes},\catvariableof{\secnodes}}
    = \frac{1}{2^{\cardof{\secnodes}}} \cdot \absof{\contractionof{\qstatewith}{\catvariableof{\secnodes}}}^2 \, .
\end{align*}
We thus sample from the contracted quantum state.
Note that in this way, the relative phases of the amplitudes are contracted before the absolutes are taken.
In this way, the measurement distribution is sensitive to the relative phases.
This property is exploited in the Deutsch-Jozsa algorithm, which utilizes signs of the amplitudes.

\begin{figure}
    \begin{center}
        \input{tikz_pics/phase_contraction_measurement.tikz}
    \end{center}
    \caption{Computational Basis Measurement of a quantum state $\qstate$, after the Walsh-Hadamard Transform on the closed qubits.
    By the ellipse we indicate a coordinatewise transform to the square of the absolute, after the contraction.}
    \label{fig:phaseContractionMeasurement}
\end{figure}

\subsection{Graph-Controlled circuits}

Let us now introduce the most generic circuit construction schemes used in this work.
To this end, we exploit the definition of uniformly controlled unitaries (see \cite{mottonen_transformation_2005}), and study their alignment along directed acyclic hypergraphs.

\begin{definition}[Graph-Controlled Circuit]
    Let $\graph=(\nodes,\edges)$ be a directed acyclic hypergraph, where each hyperedge has exactly one outgoing node and all nodes appear exactly once as outgoing nodes of an hyperedge.
    Then a by $\graph$ controlled circuit is a decoration of the edges $\edge=(\incomingnodes,\{\node\})\in\edges$ by uniformly controlled unitaries
    \begin{align*}
        \contunitaryofat{\edge}{\catvariableof{\node,\insymbol},\catvariableof{\node,\outsymbol},\catvariableof{\incomingnodes,\outsymbol}} \, .
    \end{align*}
\end{definition}

%%
\begin{example}[Generic State Representation]\label{exa:genericControlCircuit}
    In \cite{mottonen_transformation_2005} a preparation scheme for arbitrary states with real and positive amplitudes by graph-controlled circuits is presented.
    Therein, the hypergraph $\graph=(\nodes,\edges)$ is constructed as follows:
    \begin{itemize}
        \item Nodes $\nodes={[\catorder]}$
        \item Edges $\edges=\left\{([\catenumerator],\{\catenumerator\})\wcols\catenumeratorin\right\}$
    \end{itemize}
\end{example}

This is closely connected to the chain decomposition of probability distributions, and their construction
In \cite{low_quantum_2014} Bayesian Networks are prepared by graph-controlled circuits.
When in the graph $\graph$ each node appears at most once as outgoing node, it is also the hypergraph to a family of Bayesian Networks.
The measurement distributions of a state prepared by a $\graph$-controlled Circuit acting on disentangled initial states are exactly the Bayesian Networks with respect to $\graph$.

\begin{theorem}
    \label{the:graphControlledPreparesBN}
    Let $\graph$ be a directed acyclic hypergraph, such that node appears at most once as an outgoing node.
    The measurement distributions of the by $\graph$ controlled circuits acting on disentangled initial states are equal to the Bayesian Networks on $\graph$.
\end{theorem}

\begin{lemma}
    Let $\graph$ be a directed acyclic hypergraph, such that node appears at most once as an outgoing node.
    Then any Bayesian network on $\graph$ can be prepared by a $\graph$-controlled circuit with activation circuits of the conditional probability tensors.
\end{lemma}
\begin{proof}
    Let $\probwith$ be a Bayesian network on the graph $\graph$.
    Enumerate the nodes $\nodes$ of the $\graph$ by $[\atomorder]$, such that for each $\catenumeratorin$ we have $\parentsof{\catenumerator}\subset[\catenumerator]$.
    Then define a $\graph$-controlled circuit, by choosing for each $\catenumeratorin$ controlled unitaries which satisfy
    \begin{align*}
        \contunitaryofat{\catenumerator}{\catvariableof{\catenumerator,\insymbol}=0,\catvariableof{\node,\outsymbol},\catvariableof{\parentsof{\catenumerator},\outsymbol}}
        =\sqrt{\condprobof{\catvariableof{\catenumerator}}{\catvariableof{\parentsof{\catenumerator}}}} \, .
    \end{align*}
    Here we specified only the action of the controlled unitary on the basis vector $\onehotmapofat{0}{\catvariableof{\catenumerator}}$, the action on $\onehotmapofat{1}{\catvariableof{\catenumerator}}$ can be chosen by an arbitrary orthogonal unit vector. % Maybe link here the activation circuit scheme, which is already used?
    For more explicit construction, see the \activationCircuits{} in \secref{sec:functionEncoding}.
    Any such defined $\graph$-controlled circuit acting on the initial state $\bigotimes_{\catenumeratorin}\onehotmapofat{0}{\catvariableof{\catenumerator}}$ prepares a quantum state $\qstatewith$ with measurement distribution
    \begin{align*}
        \absof{\qstate}^2\left[\shortcatvariables\right] \, .
    \end{align*}
    Given arbitrary $\shortcatindicesin$ we have
    \begin{align*}
        \absof{\qstate}^2\left[\indexedshortcatvariables\right]
        = \prod_{\catenumeratorin} \condprobof{\indexedcatvariableof{\catenumerator}}{\indexedcatvariableof{\parentsof{\catenumerator}}}
        = \probat{\indexedshortcatvariables} \, .
    \end{align*}
    Here we used in the last equation, that $\probwith$ is a Bayesian network.
    Since the equivalence holds for any coordinate, this establishes the equivalence of the measurement distribution of $\qstatewith$ and $\probwith$.
\end{proof}

The contrary is true, also when nodes appear multiple times as outgoing nodes.

\begin{lemma}
    Let $(\graph,\contunitary)$ be a $\graph$-controlled circuit acting on a disentangled initial state and $\probat{\nodevariables}$ the corresponding measurement distribution.
    Then we have for each $\node\in\nodes$ the conditional independence
    \begin{align*}
        \condindependent{\catvariableof{\node}}{\catvariableof{\nondescendantsof{\node}}}{\catvariableof{\parentsof{\node}}} \, .
    \end{align*}
\end{lemma}
\begin{proof}
    We choose to a given $\node\in\nodes$ an enumeration $[\catorder]$ of the nodes, such that for each $\catenumeratorin$ we have $\parentsof{\catenumerator}\subset[\catenumerator]$ and for the enumerator $\seccatenumerator$ of $\node$ we further have $\nondescendantsof{\seccatenumerator}\subset[\seccatenumerator]$.
    Let $\probwith$ be the measurement distribution of the $\graph$-controlled circuit acting on a disentangled initial state $\bigotimes_{\catenumeratorin}\qstateofat{\catenumerator}{\catvariableof{\catenumerator}}$ and choose arbitrary $\catindexof{[\catenumerator]}$.
    We then have
    \begin{align*}
        \probat{\catvariableof{\seccatenumerator},\indexedcatvariableof{[\catenumerator]}}
        &= \contractionof{\left(\bigcup_{\catenumeratorin}\{\contunitaryof{\catenumerator},\contunitaryof{\catenumerator,\dagger},\qstateof{\catenumerator},\qstateof{\catenumerator,*}\right)\}
            \cup \left(\bigcup_{\catenumerator\in[\seccatenumerator]} \onehotmapofat{\catindexof{\catenumerator}}{\catvariableof{\catenumerator,\outsymbol}}\right)
        }{
            \catvariableof{\seccatenumerator}
        } \\
        &= \contractionof{\bigcup_{\catenumerator\in[\seccatenumerator]}\{\contunitaryof{\catenumerator},\contunitaryof{\catenumerator,\dagger},\qstateof{\catenumerator},\qstateof{\catenumerator,*},\onehotmapofat{\catindexof{\catenumerator}}{\catvariableof{\catenumerator,\outsymbol}}\}}{
            \catvariableof{\seccatenumerator}
        } \\
        & = \absof{\contractionof{\contunitaryofat{\seccatenumerator}{\catvariableof{\seccatenumerator,\insymbol},\catvariableof{\seccatenumerator,\outsymbol}},\indexedcatvariableof{\parentsof{\seccatenumerator},\outsymbol}}{\catvariableof{\seccatenumerator,\outsymbol}}}^2 \\
        & \quad \quad \cdot \prod_{\catenumerator\in[\seccatenumerator]}
        \left(\contraction{\qstateofat{\catenumerator}{\catvariableof{\catenumerator,\insymbol}},\contunitaryofat{\catenumerator}{\catvariableof{\catenumerator,\insymbol},\catvariableof{\catenumerator,\outsymbol},\indexedcatvariableof{\parentsof{\catenumerator},\outsymbol}}}\right)^2
        %\contraction{\qstateof{\catenumerator,*},\onehotmapofat{\catindexof{\catenumerator}}{\catvariableof{\catenumerator}}}{} \, .
    \end{align*}
    Here we used in the second equation the unitarity of the controlled unitaries to $\catenumerator\notin[\seccatenumerator]$.
    Since the indices $\catindexof{[\seccatenumerator]/\parentsof{\seccatenumerator}} = \catindexof{\nondescendantsof{\seccatenumerator}}$ appear only in the constant term, we conclude
    \begin{align*}
        \condprobat{\catvariableof{\seccatenumerator}}{\catvariableof{[\catenumerator]}} = \condprobat{\catvariableof{\seccatenumerator}}{\catvariableof{\parentsof{\seccatenumerator}}} \otimes \onesat{\catvariableof{\nondescendantsof{\seccatenumerator}}}\, ,
    \end{align*}
    which establishes the conditional independence $\condindependent{\catvariableof{\node}}{\catvariableof{\nondescendantsof{\node}}}{\catvariableof{\parentsof{\node}}}$.
\end{proof}

\begin{proof}[Proof of \theref{the:graphControlledPreparesBN}]
    The theorem follows directly from the two lemmas, using that Bayesian Networks are characterized by the conditional independence of each variable to its non-descendants given its parents.
\end{proof}

\begin{example}[Chain decomposition]
    The hypergraph in \exaref{exa:genericControlCircuit} corresponds with a family of Bayesian Networks subsuming any probability distribution.
    This can be verified based on the chain decomposition of a generic distribution.
\end{example}

%% Phase representation
Another question is, whether each quantum state, which measurement distribution is a Bayesian Network can be prepared by a $\graph$-controlled circuit.
This is not always the case, since the phase tensor does not influence the measurement distribution.
Any phase tensor, of a by $\graph$-controlled circuit prepared state has however a decomposition
\begin{align*}
    \phasecoreat{\shortcatvariables}
    = \sum_{\catenumeratorin} \phasecoreofat{\catenumerator}{\catvariableof{\catenumerator},\catvariableof{\parentsof{\catenumerator}}} \otimes \onesat{\catvariableof{[\catorder]/\{\{\catenumerator\}\cup\parentsof{\catenumerator}\}}} \, ,
\end{align*}
where the phase cores $\phasecoreof{\catenumerator}$ can be read of the controlled unitaries.
When there are phase cores which do not have such a decomposition, the corresponding states are not representable.
\cite{mottonen_transformation_2005} shows, that when the graph is chosen as in \exaref{exa:genericControlCircuit}, then also the phases can be represented.