\begin{tikzpicture}[scale=0.35, xscale = 0.9, thick]

    \draw (5,4) -- (5,8);
    \drawvariabledot{5}{4}
    \draw (6,1) -- (6,8);
    \drawvariabledot{6}{1}

    \draw (9,4) -- (9,8);
    \drawvariabledot{9}{4}
    \draw (10,1) -- (10,8);
    \drawvariabledot{10}{1}

    \draw (2,9) -- (4,9) node[midway,above] {\colorlabelsize $\headvariable^{\insymbol}$};
    \draw (4,8) rectangle (7,10);
    \node[anchor=center] (text) at (5.5,9) {\corelabelsize $\qcbencodingof{\exformula}$};
    \draw (7,9) -- (8,9);
    \draw (8,8) rectangle (11,10);
    \node[anchor=center] (text) at (9.5,9) {\corelabelsize $\qcbencodingof{\secexformula}$};
    \draw (11,9) -- (13,9) node[midway,above] {\colorlabelsize $\headvariable^{\outsymbol}$};

    \draw (2,4) -- (13,4);

    \node[anchor=center] (text) at (3,2.5) {\colorlabelsize $\shortcatvariables$};

    \node[anchor=center] (text) at (8,2.75) {$\vdots$};
    \node[anchor=center] (text) at (12,2.5) {\colorlabelsize $\shortcatvariables$};

    \draw (2,1) -- (13,1);

    \node[anchor=center] (text) at (14.5,5) {${=}$};

    \begin{scope}[shift={(14,0)}]

        \draw[->-] (2,9) -- (4,9) node[midway,above] {\colorlabelsize $\headvariable^{\insymbol}$};

        \draw (4,8) rectangle (7,10);
        \node[anchor=center] (text) at (5.5,9) {\corelabelsize $\bencodingof{\oplus}$};
        \draw[->-] (7,9) -- (8,9);
        \draw (8,8) rectangle (11,10);
        \node[anchor=center] (text) at (9.5,9) {\corelabelsize $\bencodingof{\oplus}$};

        \draw[->-] (5.5,7) -- (5.5,8) node[midway,right] {\colorlabelsize $\headvariable$};
        \draw (4,5) rectangle (7,7);
        \node[anchor=center] (text) at (5.5,6) {\corelabelsize $\bencodingof{\exformula}$};
        \draw[->-] (9.5,7) -- (9.5,8) node[midway,right] {\colorlabelsize $\headvariable$};
        \draw (8,5) rectangle (11,7);
        \node[anchor=center] (text) at (9.5,6) {\corelabelsize $\bencodingof{\secexformula}$};

        \draw[->-] (11,9) -- (13,9) node[midway,above] {\colorlabelsize $\headvariable^{\outsymbol}$};

        \draw[->-] (5,4) -- (5,5);
        \drawvariabledot{5}{4}
        \draw[->-] (6,1) -- (6,5);
        \drawvariabledot{6}{1}

        \draw[->-] (9,4) -- (9,5);
        \drawvariabledot{9}{4}
        \draw[->-] (10,1) -- (10,5);
        \drawvariabledot{10}{1}

        \draw (2,4) -- (13,4);

        \node[anchor=center] (text) at (3,2.5) {\colorlabelsize $\shortcatvariables$};

        \node[anchor=center] (text) at (7,2.75) {$\vdots$};
        \node[anchor=center] (text) at (12,2.5) {\colorlabelsize $\shortcatvariables$};

        \draw (2,1) -- (13,1);

    \end{scope}

    \node[anchor=center] (text) at (28,5) {${=}$};

    \begin{scope}[shift={(27,-1.5)}]

        \draw[->-] (2,12) -- (6,12) node[midway,above] {\colorlabelsize $\headvariable^{\insymbol}$};
        \draw[->-] (9,12) -- (13,12) node[midway,above] {\colorlabelsize $\headvariable^{\outsymbol}$};

        \draw (6,11) rectangle (9,13);
        \node[anchor=center] (text) at (7.5,12) {\corelabelsize $\bencodingof{\oplus}$};
        \draw[->-] (7.5,10) -- (7.5,11);
        \draw (4,8) rectangle (11,10);
        \node[anchor=center] (text) at (7.5,9) {\corelabelsize $\bencodingof{\oplus}$};

        \draw[->-] (5.5,7) -- (5.5,8);% node[midway,right] {\colorlabelsize $\headvariable$};
        \draw (4,5) rectangle (7,7);
        \node[anchor=center] (text) at (5.5,6) {\corelabelsize $\bencodingof{\exformula}$};
        \draw[->-] (9.5,7) -- (9.5,8);% node[midway,right] {\colorlabelsize $\headvariable$};
        \draw (8,5) rectangle (11,7);
        \node[anchor=center] (text) at (9.5,6) {\corelabelsize $\bencodingof{\secexformula}$};



        \draw[->-] (5,4) -- (5,5);
        \drawvariabledot{5}{4}
        \draw[->-] (6,1) -- (6,5);
        \drawvariabledot{6}{1}

        \draw[->-] (9,4) -- (9,5);
        \drawvariabledot{9}{4}
        \draw[->-] (10,1) -- (10,5);
        \drawvariabledot{10}{1}

        \draw (2,4) -- (13,4);

        \node[anchor=center] (text) at (3,2.5) {\colorlabelsize $\shortcatvariables$};

        \node[anchor=center] (text) at (7,2.75) {$\vdots$};
        \node[anchor=center] (text) at (12,2.5) {\colorlabelsize $\shortcatvariables$};

        \draw (2,1) -- (13,1);

    \end{scope}

    \node[anchor=center] (text) at (41,5) {${=}$};

    \begin{scope}[shift={(40,0)}]

        \draw (5,4) -- (5,8);
        \drawvariabledot{5}{4}
        \draw (6,1) -- (6,8);
        \drawvariabledot{6}{1}

        \draw (2,9) -- (4,9) node[midway,above] {\colorlabelsize $\headvariable^{\insymbol}$};
        \draw (4,8) rectangle (7,10);
        \node[anchor=center] (text) at (5.5,9) {\corelabelsize $\qcbencodingof{\exformula\oplus\secexformula}$};
        \draw (7,9) -- (9,9) node[midway,above] {\colorlabelsize $\headvariable^{\outsymbol}$};

        \draw (2,4) -- (9,4);

        \node[anchor=center] (text) at (3,2.5) {\colorlabelsize $\shortcatvariables$};

        \node[anchor=center] (text) at (4,2.75) {$\vdots$};
        \node[anchor=center] (text) at (8,2.5) {\colorlabelsize $\shortcatvariables$};

        \draw (2,1) -- (9,1);

    \end{scope}

\end{tikzpicture}